<!DOCTYPE html>
<html>
<head>
	<title>doormat</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" href="style.css">
</head>
<body>
	<ol>
		<li style="background-color: red;">
			red
		</li>
		<li style="background-color: blue;">
			blue
		</li>
		<li style="background-color: green;">
			green
		<li style="background-color: yellow;">
			yellow
		</li>
		<li style="background-color: purple;">
			purple
		</li>
	</ol>
	<script type="text/javascript">
		var doormat = function (element, options) {
			this.element = element;
			this.multiple = (options && options.multiple) ? options.multiple: false;
			if (this.element) {
				this.setUp();
			}
		}
		doormat.prototype.setUp = function () {
			var doormat = this;
			(doormat.multiple) ? doormat.element.className += ' doormat-multiple': doormat.element.className += ' doormat';
			if (doormat.multiple && (doormat.element.tagName === 'OL' || doormat.element.tagName === 'UL')) {
				var panels = doormat.element.querySelectorAll('li');
				[].forEach.call(panels, function(panel, index) {
					panel.className += ' doormat-panel';
				});				
				panels[0].className += ' current';
				panels[1].className += ' next';
			} else {
				doormat.element.nextElementSibling.className += ' doormat-page-content';
			}
			doormat.bindEvents();
		}
		doormat.prototype.bindEvents = function () {
			// We ideally need to set up how this works here so scroll up and down we always have a current doormat which reveals our next panel which becomes our doormat. The min height has to be the the current viewport height. Then have a margin of 100%. Then on top of that when it scrolls past it's lower border then we simply update the current, remove the current class from the current current maybe make it display none. We only care about the current and the next if we are honest well for going forward, backwards is a different matter and will have to work that part out as we go along.
			var doormat = this,
				doormatHeight = (doormat.multiple) ? doormat.element.querySelector('.current').offsetHeight: doormat.element.offsetHeight,
				iOSDevice = (navigator.userAgent.match(/iPad/i)) || (navigator.userAgent.match(/iPhone/i)) || (navigator.userAgent.match(/iPod/i)),
				createiOSHeight = function () {
					window.scrollTo(0, 1);
					doormat.element.setAttribute('style', 'min-height: ' + window.innerHeight + 'px;');
				}
			if (iOSDevice && !doormat.multiple) {
				doormat.element.className += ' iOS';
				createiOSHeight();
				window.onorientationchange = function () {
					createiOSHeight();
				}
			}
			if (!doormat.multiple) {
				window.onscroll = function () {
					if (window.scrollY >= doormatHeight) {
						document.body.className = 'in-content';
					} else {
						document.body.className = '';
					}
				};
			} else if (doormat.multiple) {
				window.onscroll = function () {
					if (window.scrollY > doormatHeight) {
						var currentDm = doormat.element.querySelector('.current'),
							previousDm = currentDm.previousElementSibling,
							newCurrent = currentDm.nextElementSibling;
						if(newCurrent.nextElementSibling) {
							if (previousDm) {
								previousDm.className = previousDm.className.replace('previous', '');	
							}
							currentDm.className = currentDm.className.replace('current', 'previous');
							newCurrent.className = newCurrent.className.replace('next', 'current');
							newCurrent.nextElementSibling.className += ' next';
							currentDm = doormat.element.querySelector('.current');
							window.scrollTo(0, currentDm.offsetTop);
							doormatHeight = currentDm.offsetTop + currentDm.offsetHeight;
						}
					} else if (window.scrollY < doormat.element.querySelector('.current').offsetTop) {
						var currentDm = doormat.element.querySelector('.current'),
							previousDm = currentDm.nextElementSibling,
							newCurrent = currentDm.previousElementSibling;
						//basically need to make the previous the new current and the current the new next whilst making any current next nothing.
						// if (newCurrent.previousElementSibling) {
							//make the current the next
							//nullify the next
							if (newCurrent.previousElementSibling) {
								newCurrent.previousElementSibling.className += ' previous';
								window.scrollTo(0, newCurrent.previousElementSibling.offsetTop + newCurrent.previousElementSibling.offsetHeight);
							}
							newCurrent.className = newCurrent.className.replace('previous', 'current');
							currentDm.className = currentDm.className.replace('current', 'next');
							//if there is a previous element sibling then make that the previous
							//make the previous the new current
							if (previousDm) {
								previousDm.className = previousDm.className.replace('next', '');
							}
							// previousDm.className = previousDm.className.replace('previous', 'current');
							doormatHeight = newCurrent.offsetTop + newCurrent.offsetHeight;	
						// }
					}
				}
			}
		}
		var myDoormat = new doormat(document.getElementsByTagName('header')[0]);
		var myMultDoormat = new doormat(document.getElementsByTagName('ol')[0], {'multiple': true});
	</script>
</body>
</html>
